
when:
  - event: push
    branch: main

steps:
  - name: build
    image: docker:latest
    commands:
      - docker build -t registry.oci.w3studio.it/mammamia:latest ./mammamia
      - docker build -t registry.oci.w3studio.it/mfp:latest ./mfp

  - name: push
    image: docker:latest
    commands:
      - echo "$OCI_REGISTRY_PASSWORD" | docker login -u "$OCI_REGISTRY_USER" --password-stdin registry.oci.w3studio.it
      - docker push registry.oci.w3studio.it/mammamia:latest
      - docker push registry.oci.w3studio.it/mfp:latest
    environment:
      OCI_REGISTRY_PASSWORD:
        from_secret: OCI_REGISTRY_PASSWORD
      OCI_REGISTRY_USER:
        from_secret: OCI_REGISTRY_USER
